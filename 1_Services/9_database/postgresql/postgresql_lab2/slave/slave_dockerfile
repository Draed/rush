FROM postgres:15.1-alpine

LABEL maintainer "ottomatic"

ENV POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
ENV POSTGRES_DB=$POSTGRES_DB
ENV POSTGRES_USER=$POSTGRES_USER
ENV POSTGRES_USER_PASSWORD=$POSTGRES_USER_PASSWORD
ENV POSTGRES_REPLICATION_USER=$POSTGRES_REPLICATION_USER
ENV POSTGRES_REPLICATION_PASSWD=$POSTGRES_REPLICATION_PASSWD
ENV MASTER_HOST=$MASTER_HOST
ENV MASTER_PORT=$MASTER_PORT
ENV MASTER_REPLICATION_MODE=$MASTER_REPLICATION_MODE
ENV SLAVE_REPLICATION_MODE=$SLAVE_REPLICATION_MODE

# ENV GOSU_VERSION 1.10
# ADD ./gosu /usr/bin/
# RUN chmod +x /usr/bin/gosu
# RUN apk add --update iputils
COPY ./entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh && chown postgres /entrypoint.sh
USER postgres
ENTRYPOINT ["/entrypoint.sh"]
# CMD ["gosu", "postgres", "postgres"]